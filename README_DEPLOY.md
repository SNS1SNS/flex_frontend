# Инструкция по деплою React-приложения на сервер

## Описание скрипта

Скрипт `deploy.sh` автоматизирует процесс деплоя React-приложения на сервер. Скрипт выполняет следующие операции:

1. Проверяет соединение с сервером
2. Проверяет DNS-записи домена
3. Создает необходимые директории на сервере
4. Устанавливает Node.js и менеджер процессов PM2 на сервере
5. Собирает React-приложение локально
6. Копирует сборку на сервер
7. Создает необходимые файлы для запуска Express-сервера
8. Настраивает PM2 для автоматического запуска приложения
9. Настраивает Nginx в качестве прокси
10. Настраивает SSL-сертификаты с помощью certbot

## Требования

Для Windows:
- Git Bash, WSL или другой терминал с поддержкой Bash
- Node.js и npm
- Установленный пакет `sshpass` для аутентификации по SSH с паролем

Для Linux/macOS:
- Bash
- Node.js и npm
- Установленный пакет `sshpass` (установка: `sudo apt-get install sshpass` для Ubuntu/Debian)

## Подготовка к деплою

1. Убедитесь, что ваше React-приложение корректно собирается локально:
   ```
   npm install
   npm run build
   ```

2. Проверьте и при необходимости измените параметры в начале скрипта `deploy.sh`:
   - `SERVER_HOST` - хост сервера для подключения
   - `SERVER_PASSWORD` - пароль для SSH-подключения
   - `SERVER_DIR` - директория на сервере
   - `REACT_DIR` - директория для React-приложения
   - `DOMAIN` - домен, на котором будет доступно приложение
   - `SERVER_PORT` - порт, на котором будет запущен Express-сервер

## Использование скрипта в Windows

### Способ 1: Git Bash

1. Установите Git Bash, если он еще не установлен
2. Откройте Git Bash в директории с проектом
3. Сделайте скрипт исполняемым:
   ```
   chmod +x deploy.sh
   ```
4. Запустите скрипт:
   ```
   ./deploy.sh
   ```

### Способ 2: WSL (Windows Subsystem for Linux)

1. Установите WSL, если он еще не установлен
2. Откройте терминал WSL
3. Перейдите в директорию проекта
4. Сделайте скрипт исполняемым:
   ```
   chmod +x deploy.sh
   ```
5. Запустите скрипт:
   ```
   ./deploy.sh
   ```

### Способ 3: PowerShell с прямым вызовом bash

Если у вас установлен bash (например, через Git Bash), вы можете:

1. Открыть PowerShell
2. Выполнить команду:
   ```
   bash deploy.sh
   ```

## Использование скрипта в Linux/macOS

1. Откройте терминал
2. Перейдите в директорию проекта
3. Сделайте скрипт исполняемым:
   ```
   chmod +x deploy.sh
   ```
4. Запустите скрипт:
   ```
   ./deploy.sh
   ```

## Параметры командной строки

- `--no-ssl` - пропустить настройку SSL-сертификата

Пример:
```
./deploy.sh --no-ssl
```

## Советы по решению проблем

1. **Ошибка при подключении к серверу**:
   - Проверьте доступность сервера по IP-адресу
   - Проверьте правильность пароля
   - Убедитесь, что у вас установлен `sshpass`

2. **Ошибка при сборке React-приложения**:
   - Проверьте, что приложение собирается локально командой `npm run build`
   - Проверьте наличие всех зависимостей в package.json

3. **Ошибка при настройке Nginx**:
   - Проверьте, установлен ли Nginx на сервере
   - Проверьте права доступа к файлам конфигурации Nginx

4. **Ошибка при настройке SSL**:
   - Убедитесь, что домен корректно настроен и указывает на ваш сервер
   - Проверьте, свободен ли 80 порт для проверки Let's Encrypt

## Безопасность

Обратите внимание, что хранение паролей непосредственно в скрипте не рекомендуется для production-окружений. Для повышения безопасности рекомендуется:

1. Настроить SSH-авторизацию по ключам
2. Перенести чувствительные данные в переменные окружения или в отдельный конфигурационный файл
3. Ограничить права доступа к скрипту командой `chmod 700 deploy.sh` 